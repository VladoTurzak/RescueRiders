<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rescue Riders â€” Play Now</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:Arial,Helvetica,sans-serif}
    body{background:url('assets/hero_intro.png') center/cover no-repeat}

    /* wrapper cez celÃ½ viewport */
    #stage{position:fixed; inset:0; z-index:1; pointer-events:none;} /* ðŸ”’ pred Å¡tartom pasÃ­vne */

    /* kontajner pre canvas */
    #fit-layer{position:absolute; left:0; top:0; width:100%; height:100%}

    /* joystick (zapneme ho aÅ¾ po Å¡tarte hry) */
    :root{ --joy: min(22vmin, 120px); --knob: calc(var(--joy)*.30) }
    #joy{position:fixed; width:var(--joy); height:var(--joy); touch-action:none; display:none; z-index:5}
    #joy-base{position:absolute; inset:0; border-radius:50%; background:rgba(255,255,255,.08); border:2px solid rgba(255,255,255,.25)}
    #joy-stick{position:absolute; width:var(--knob); height:var(--knob); left:calc(50% - var(--knob)/2); top:calc(50% - var(--knob)/2); border-radius:50%; background:rgba(255,255,255,.75); box-shadow:0 0 12px rgba(0,0,0,.45); will-change:transform; transition:transform .03s linear}

    /* portrÃ©t blok (iba touch) */
    #rotate-block{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:#000; color:#fff; text-align:center; z-index:9999; padding:24px}
    #rotate-block .card{max-width:560px}
    #rotate-block h3{margin:0 0 8px; font-size:22px}
    @media (pointer:coarse) and (orientation:portrait){ #rotate-block{display:flex} }

    /* nickname modal â€“ najvyÅ¡Å¡ia vrstva, full focus */
    #nick{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,.65); padding:32px 40px; border-radius:14px; color:#fff; text-align:center;
      z-index:10000; box-shadow:0 0 30px rgba(0,0,0,.6); animation:fadeIn .8s ease;
    }
    #nick h2{margin:0 0 8px; color:#ffcc00}
    #nick input{
      width:80%; padding:10px; border:none; border-radius:8px; text-align:center; outline:none;
      -webkit-user-select:text; user-select:text; /* iOS focus */
      touch-action:manipulation;                     /* iOS tap */
      background:#fff; color:#000;
    }
    #nick button{margin-top:12px; padding:10px 22px; border:none; border-radius:8px; background:#ffcc00; color:#000; font-weight:700; cursor:pointer}
    #nick button:hover{background:#ffe55c; transform:scale(1.03)}
    @keyframes fadeIn{from{opacity:0; transform:translate(-50%,-46%)} to{opacity:1; transform:translate(-50%,-50%)}}
  </style>
</head>
<body>
  <!-- portrÃ©t blok -->
  <div id="rotate-block"><div class="card">
    <h3>Rotate your device</h3><p>Rescue Riders je dostupnÃ½ iba v <b>landscape</b> reÅ¾ime.</p>
  </div></div>

  <!-- nickname -->
  <div id="nick">
    <h2>ðŸŒŠ Rescue Riders</h2>
    <p>Enter your nickname to begin:</p>
    <input id="n" maxlength="12" placeholder="Your name" autofocus />
    <br /><button id="go">Start</button>
  </div>

  <!-- scÃ©na -->
  <div id="stage">
    <div id="fit-layer"></div>
    <div id="joy"><div id="joy-base"></div><div id="joy-stick"></div></div>
  </div>

  <!-- Phaser -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

  <script>
    const GW=900, GH=600, R=GW/GH;
    const nickEl=document.getElementById('nick'), go=document.getElementById('go'), inp=document.getElementById('n');
    const stage=document.getElementById('stage'), layer=document.getElementById('fit-layer');
    const joy=document.getElementById('joy'), knob=document.getElementById('joy-stick'), base=document.getElementById('joy-base');

    function mountMain(){
      const s=document.createElement('script'); s.src='main.js'; document.body.appendChild(s);

      const wait=setInterval(()=>{
        const cv=document.querySelector('#fit-layer canvas') || document.querySelector('canvas');
        if(!cv) return;
        clearInterval(wait);
        if(cv.parentElement!==layer) layer.appendChild(cv);
        cv.style.imageRendering='auto';

        // teraz uÅ¾ mÃ´Å¾eme zapnÃºÅ¥ interakcie pre stage a zobraziÅ¥ joystick (iba touch+landscape)
        stage.style.pointerEvents='auto';
        if (window.matchMedia && matchMedia('(pointer:coarse)').matches && matchMedia('(orientation:landscape)').matches){
          joy.style.display='block';
        }

        function fit(){
          const WW=window.innerWidth, WH=window.innerHeight;
          let w,h; if(WW/WH>R){ h=WH; w=Math.floor(h*R);} else { w=WW; h=Math.floor(w/R);}
          cv.style.position='absolute'; cv.style.width=w+'px'; cv.style.height=h+'px';
          cv.style.left=((WW-w)/2)+'px'; cv.style.top=((WH-h)/2)+'px';
          const pad=16;
          const joyH=parseFloat(getComputedStyle(joy).height)||0;
          joy.style.left=((WW-w)/2 + pad)+'px';
          joy.style.top=((WH-h)/2 + h - joyH - pad)+'px';
        }
        fit(); addEventListener('resize',fit); addEventListener('orientationchange',()=>setTimeout(fit,50));
      },20);
    }

    function startGame(){
      const v=inp.value.trim(); if(!v){alert('Please enter your nickname'); inp.focus(); return;}
      localStorage.setItem('rr_nickname',v);
      nickEl.style.display='none';
      mountMain();
    }

    go.addEventListener('click', startGame);
    inp.addEventListener('keydown', e=>{ if(e.key==='Enter') startGame(); });
    // po naÄÃ­tanÃ­ zafokusuj input (iOS)
    window.addEventListener('load', ()=>{ setTimeout(()=>{ try{ inp.focus(); }catch{} }, 50);
      if(localStorage.getItem('rr_nickname')){ nickEl.style.display='none'; mountMain(); }
    });

    /* Joystick -> simulÃ¡cia Å¡Ã­pok (zapnutÃ© aÅ¾ po startGame, keÄ stage povolÃ­ pointer-events) */
    (function(){
      const isTouch = window.matchMedia && matchMedia('(pointer:coarse)').matches;
      if(!isTouch) return;
      let state={L:false,R:false,U:false,D:false};
      const send=(key,type)=>{ const map={ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40};
        window.dispatchEvent(new KeyboardEvent(type,{key,code:key,keyCode:map[key],which:map[key],bubbles:true})); };
      function center(){ const r=joy.getBoundingClientRect(); return {x:r.left+r.width/2,y:r.top+r.height/2,rad:Math.min(r.width,r.height)*0.4}; }
      function move(x,y){ const c=center(); let dx=x-c.x,dy=y-c.y; const len=Math.hypot(dx,dy)||1,R=c.rad; if(len>R){dx=dx/len*R;dy=dy/len*R}
        knob.style.transform=`translate(${dx}px,${dy}px)`; const nx=dx/R,ny=dy/R; const want={L:nx<-0.35,R:nx>0.35,U:ny<-0.35,D:ny>0.35};
        if(want.L&&!state.L)send('ArrowLeft','keydown'); if(!want.L&&state.L)send('ArrowLeft','keyup');
        if(want.R&&!state.R)send('ArrowRight','keydown'); if(!want.R&&state.R)send('ArrowRight','keyup');
        if(want.U&&!state.U)send('ArrowUp','keydown');   if(!want.U&&state.U)send('ArrowUp','keyup');
        if(want.D&&!state.D)send('ArrowDown','keydown'); if(!want.D&&state.D)send('ArrowDown','keyup');
        state=want; }
      function release(){ knob.style.transform='translate(0px,0px)'; ['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].forEach(k=>send(k,'keyup')); state={L:false,R:false,U:false,D:false}; }
      base.addEventListener('touchstart',e=>{const t=e.changedTouches[0];move(t.clientX,t.clientY)},{passive:true});
      base.addEventListener('touchmove', e=>{const t=e.changedTouches[0];move(t.clientX,t.clientY)},{passive:true});
      base.addEventListener('touchend',  release,{passive:true});
      base.addEventListener('touchcancel',release,{passive:true});
      addEventListener('resize', release);
    })();
  </script>
</body>
</html>
