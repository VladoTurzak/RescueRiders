<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rescue Riders ‚Äî Play Now</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <style>
    html, body {
      margin:0; padding:0; height:100%;
      overflow:hidden; background:#000; font-family:Arial,Helvetica,sans-serif;
    }
    /* üåä Fullscreen background (za hrou) */
    body { background:url('assets/hero_intro.png') center center / cover no-repeat; }

    /* Hra ‚Äì presne ako v tvojej stabilnej verzii */
    #game-container { width:100%; height:100%; position:relative; z-index:1; display:none; }

    /* üí¨ Nickname modal (nezmenen√© spr√°vanie) */
    #nickname-form{
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,.65); padding:32px 40px; border-radius:14px;
      color:#fff; text-align:center; z-index:10; box-shadow:0 0 30px rgba(0,0,0,.6);
      animation:fadeIn .8s ease;
    }
    #nickname-form h2{margin:0 0 8px; color:#ffcc00;}
    #nickname-form input{width:80%; padding:10px; border:none; border-radius:8px; text-align:center; outline:none;}
    #nickname-form button{
      margin-top:12px; padding:10px 22px; border:none; border-radius:8px;
      background:#ffcc00; color:#000; font-weight:700; cursor:pointer;
    }
    #nickname-form button:hover{ background:#ffe55c; transform:scale(1.03); }
    @keyframes fadeIn{from{opacity:0; transform:translate(-50%,-46%)} to{opacity:1; transform:translate(-50%,-50%)}}

    /* üö´ Blokovanie portr√©tu (iba touch zariadenia) */
    #rotate-block{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:#000; color:#fff; text-align:center; z-index:9999; padding:24px;
    }
    #rotate-block .card{max-width:560px;}
    #rotate-block h3{margin:0 0 8px; font-size:22px}

    /* üïπÔ∏è On-screen joystick ‚Äì v≈ædy plne viditeƒæn√Ω (touch) */
    :root{
      /* veƒækos≈• joysticku ≈°k√°luje podƒæa obrazovky, max 120px */
      --joy: min(22vmin, 120px);
      --joy-knob: calc(var(--joy) * 0.30);
      --pad: 14px;
    }
    #rr-joy{
      position:absolute;
      left: calc(max(var(--pad), env(safe-area-inset-left, 0px)));
      bottom: calc(max(var(--pad), env(safe-area-inset-bottom, 0px)));
      width: var(--joy); height: var(--joy);
      z-index: 5; touch-action:none; display:none;
    }
    #rr-joy-base{
      position:absolute; inset:0; border-radius:50%;
      background:rgba(255,255,255,.08); border:2px solid rgba(255,255,255,.25);
      box-sizing:border-box;
    }
    #rr-joy-knob{
      position:absolute;
      width: var(--joy-knob); height: var(--joy-knob);
      left: calc(50% - var(--joy-knob)/2); top: calc(50% - var(--joy-knob)/2);
      border-radius:50%; background:rgba(255,255,255,.75); box-shadow:0 0 12px rgba(0,0,0,.45);
      will-change: transform;
      transition: transform .03s linear;
    }

    /* Zobrazi≈• joystick len na touch zariadeniach a len v landscape */
    @media (pointer:coarse) and (orientation:landscape){ #rr-joy{display:block} }
    /* V portr√©te blokuj hru (touch) */
    @media (pointer:coarse) and (orientation:portrait){ #rotate-block{display:flex} }
  </style>
</head>
<body>
  <!-- üö´ Portr√©t zak√°zan√Ω (iba touch) -->
  <div id="rotate-block">
    <div class="card">
      <h3>Rotate your device</h3>
      <p>Rescue Riders je dostupn√Ω iba v <b>landscape</b> re≈æime.</p>
    </div>
  </div>

  <!-- üí¨ Nickname Form -->
  <div id="nickname-form">
    <h2>üåä Rescue Riders</h2>
    <p>Enter your nickname to begin:</p>
    <input id="nickname" type="text" maxlength="12" placeholder="Your name" autofocus />
    <br />
    <button id="start-btn">Start Game</button>
  </div>

  <!-- üéÆ Game Container (+ joystick) -->
  <div id="game-container">
    <div id="rr-joy">
      <div id="rr-joy-base"></div>
      <div id="rr-joy-knob"></div>
    </div>
  </div>

  <!-- Phaser engine -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

  <script>
    // ======= p√¥vodn√° logika spustenia (desktop spr√°vanie sa nemen√≠) =======
    const form = document.getElementById('nickname-form');
    const startBtn = document.getElementById('start-btn');
    const input = document.getElementById('nickname');
    const container = document.getElementById('game-container');

    function startGame() {
      const nick = input.value.trim();
      if (!nick) { alert('Please enter your nickname first!'); return; }
      localStorage.setItem('rr_nickname', nick);
      form.style.display = 'none';
      container.style.display = 'block';
      const script = document.createElement('script');
      script.src = 'main.js';
      document.body.appendChild(script);
    }
    startBtn.addEventListener('click', startGame);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') startGame(); });
    window.addEventListener('load', () => {
      const existingNick = localStorage.getItem('rr_nickname');
      if (existingNick) {
        form.style.display = 'none';
        container.style.display = 'block';
        const script = document.createElement('script');
        script.src = 'main.js';
        document.body.appendChild(script);
      }
    });

    // ======= üïπÔ∏è Joystick -> simuluje ≈°√≠pky (bez z√°sahu do main.js) =======
    (function(){
      const isTouch = window.matchMedia && matchMedia('(pointer:coarse)').matches;
      if(!isTouch) return; // desktop: niƒç nemen√≠me

      const joy = document.getElementById('rr-joy'),
            knob = document.getElementById('rr-joy-knob'),
            base = document.getElementById('rr-joy-base');

      if(!joy || !knob || !base) return;

      let state = {L:false,R:false,U:false,D:false};
      const send = (key, type) => {
        const keyCodeMap = {ArrowLeft:37, ArrowUp:38, ArrowRight:39, ArrowDown:40};
        const evt = new KeyboardEvent(type, {
          key, code:key, keyCode:keyCodeMap[key], which:keyCodeMap[key], bubbles:true
        });
        window.dispatchEvent(evt);
      };

      function center(){ const r=joy.getBoundingClientRect(); return {x:r.left + r.width/2, y:r.top + r.height/2, r:Math.min(r.width,r.height)/2 * 0.8}; }
      function move(cx, cy){
        const c=center();
        let dx=cx - c.x, dy=cy - c.y;
        const len=Math.hypot(dx,dy) || 1, R=c.r;
        if(len>R){ dx=dx/len*R; dy=dy/len*R; }
        knob.style.transform = `translate(${dx}px, ${dy}px)`;
        const nx = dx/R, ny = dy/R;
        const want = {L:nx<-0.35, R:nx>0.35, U:ny<-0.35, D:ny>0.35};

        if (want.L && !state.L) send('ArrowLeft','keydown');
        if (!want.L && state.L) send('ArrowLeft','keyup');
        if (want.R && !state.R) send('ArrowRight','keydown');
        if (!want.R && state.R) send('ArrowRight','keyup');
        if (want.U && !state.U) send('ArrowUp','keydown');
        if (!want.U && state.U) send('ArrowUp','keyup');
        if (want.D && !state.D) send('ArrowDown','keydown');
        if (!want.D && state.D) send('ArrowDown','keyup');

        state = want;
      }
      function release(){
        knob.style.transform = 'translate(0px, 0px)';
        ['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].forEach(k=>send(k,'keyup'));
        state = {L:false,R:false,U:false,D:false};
      }

      base.addEventListener('touchstart', e=>{ const t=e.changedTouches[0]; move(t.clientX,t.clientY); }, {passive:true});
      base.addEventListener('touchmove',  e=>{ const t=e.changedTouches[0]; move(t.clientX,t.clientY); }, {passive:true});
      base.addEventListener('touchend',   release, {passive:true});
      base.addEventListener('touchcancel',release, {passive:true});

      // Pri zmene orient√°cie/veƒækosti resetni polohu gomb√≠ka (garancia viditeƒænosti)
      addEventListener('resize', ()=>release());
    })();
  </script>
</body>
</html>
